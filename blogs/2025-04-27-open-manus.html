<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@frankkklee"/><meta name="twitter:creator" content="@frankkklee"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_IE"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Understanding OpenManus: How Agent Systems Work</title><meta name="robots" content="index,follow"/><meta name="description" content="Discover how agent systems like OpenManus plan, coordinate, and adapt to complete complex tasks"/><meta property="og:title" content="Understanding OpenManus: How Agent Systems Work"/><meta property="og:description" content="Discover how agent systems like OpenManus plan, coordinate, and adapt to complete complex tasks"/><meta property="og:url" content="https://franklee.xyz/blogs/2025-04-27-open-manus"/><meta property="og:image" content="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/cover.png"/><meta property="og:image:alt" content="Understanding OpenManus: How Agent Systems Work"/><meta property="og:site_name" content="Shenggui Li"/><link rel="canonical" href="https://franklee.xyz/blogs/2025-04-27-open-manus"/><meta name="next-head-count" content="17"/><meta charSet="utf-8"/><meta name="keywords" content="Shenggui Li, Li Shenggui, Shenggui, Frank Lee, FrankLeeeeee, NTU"/><meta name="theme-color" content="#000000"/><link rel="icon" href="/favicon.ico"/><link rel="manifest" href="/manifest.json"/><link rel="preload" href="/_next/static/media/9bf67a161a796382-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/6d5c3ee328855b5c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6d5c3ee328855b5c.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-ff7f418116f76b2d.js" defer=""></script><script src="/_next/static/chunks/main-dacc7e304366e363.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1245d62b80742923.js" defer=""></script><script src="/_next/static/chunks/72-d3a1a5b5749a0dfe.js" defer=""></script><script src="/_next/static/chunks/323-c45424aa17199243.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-e831998545c158b5.js" defer=""></script><script src="/_next/static/QZoNBVUQXCAFi14FF8sCC/_buildManifest.js" defer=""></script><script src="/_next/static/QZoNBVUQXCAFi14FF8sCC/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__className_88131f"><nav class="bg-black shadow" data-headlessui-state=""><div class="mx-auto max-w-7xl px-2 sm:px-4 lg:px-8"><div class="flex h-16 justify-between"><div class="flex px-2 lg:px-0"><div class="flex flex-shrink-0 items-center"><img class="block h-16 w-auto md:hidden" src="/assets/logo.png" alt="Your Company"/><img class="hidden h-16 w-auto md:block" src="/assets/logo.png" alt="Your Company"/></div></div><div class="hidden items-center md:ml-6 md:space-x-8 md:flex md:flex-1  md:justify-end"><a class="inline-flex items-center px-1 pt-1 text-sm font-medium text-slate-200" href="/">Home</a><a class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-slate-200" href="/about">About</a><a class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-slate-200 " href="/blogs">Blogs</a><a target="_blank" rel="noopener noreferrer" class="inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-slate-200 " href="/assets/cv.pdf">CV</a></div><div class="flex items-center md:hidden"><button class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" id="headlessui-disclosure-button-:R6m:" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open main menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="block h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div></div></div></nav><div class="container mx-auto py-8 px-8 md:px-16 lg:px-36"><div><article class="prose mx-auto text-slate-400"><h1 class="text-4xl text-white font-bold">Understanding OpenManus: How Agent Systems Work</h1><h4 class="text-sm text-slate-400">Published on <!-- -->2025-04-27</h4><h4 class="text-sm text-slate-400">Reading time: <!-- -->16 min read</h4><h4 class="text-sm text-slate-400">Description: <!-- -->Discover how agent systems like OpenManus plan, coordinate, and adapt to complete complex tasks</h4><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/cover.png" alt="blog" lazy="loa/ding"/><div class="flex items-center gap-2"><span class="text-sm text-slate-400">Share to:</span><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24" class="rounded-full border border-white"><circle cx="32" cy="32" r="32" fill="#000000"></circle><path d="M 41.116 18.375 h 4.962 l -10.8405 12.39 l 12.753 16.86 H 38.005 l -7.821 -10.2255 L 21.235 47.625 H 16.27 l 11.595 -13.2525 L 15.631 18.375 H 25.87 l 7.0695 9.3465 z m -1.7415 26.28 h 2.7495 L 24.376 21.189 H 21.4255 z" fill="white"></path></svg></button><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="32" fill="#0077B5"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="32" fill="#0965FE"></circle><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="32" fill="#25D366"></circle><path d="m42.32286,33.93287c-0.5178,-0.2589 -3.04726,-1.49644 -3.52105,-1.66732c-0.4712,-0.17346 -0.81554,-0.2589 -1.15987,0.2589c-0.34175,0.51004 -1.33075,1.66474 -1.63108,2.00648c-0.30032,0.33658 -0.60064,0.36247 -1.11327,0.12945c-0.5178,-0.2589 -2.17994,-0.80259 -4.14759,-2.56312c-1.53269,-1.37217 -2.56312,-3.05503 -2.86603,-3.57283c-0.30033,-0.5178 -0.03366,-0.80259 0.22524,-1.06149c0.23301,-0.23301 0.5178,-0.59547 0.7767,-0.90616c0.25372,-0.31068 0.33657,-0.5178 0.51262,-0.85437c0.17088,-0.36246 0.08544,-0.64725 -0.04402,-0.90615c-0.12945,-0.2589 -1.15987,-2.79613 -1.58964,-3.80584c-0.41424,-1.00971 -0.84142,-0.88027 -1.15987,-0.88027c-0.29773,-0.02588 -0.64208,-0.02588 -0.98382,-0.02588c-0.34693,0 -0.90616,0.12945 -1.37736,0.62136c-0.4712,0.5178 -1.80194,1.76053 -1.80194,4.27186c0,2.51134 1.84596,4.945 2.10227,5.30747c0.2589,0.33657 3.63497,5.51458 8.80262,7.74113c1.23237,0.5178 2.1903,0.82848 2.94111,1.08738c1.23237,0.38836 2.35599,0.33657 3.24402,0.20712c0.99159,-0.15534 3.04985,-1.24272 3.47963,-2.45956c0.44013,-1.21683 0.44013,-2.22654 0.31068,-2.45955c-0.12945,-0.23301 -0.46601,-0.36247 -0.98382,-0.59548m-9.40068,12.84407l-0.02589,0c-3.05503,0 -6.08417,-0.82849 -8.72495,-2.38189l-0.62136,-0.37023l-6.47252,1.68286l1.73463,-6.29129l-0.41424,-0.64725c-1.70875,-2.71846 -2.6149,-5.85116 -2.6149,-9.07706c0,-9.39809 7.68934,-17.06155 17.15993,-17.06155c4.58253,0 8.88029,1.78642 12.11655,5.02268c3.23625,3.21036 5.02267,7.50812 5.02267,12.06476c-0.0078,9.3981 -7.69712,17.06155 -17.14699,17.06155m14.58906,-31.58846c-3.93529,-3.80584 -9.1133,-5.95471 -14.62789,-5.95471c-11.36055,0 -20.60848,9.2065 -20.61625,20.52564c0,3.61684 0.94757,7.14565 2.75211,10.26282l-2.92557,10.63564l10.93337,-2.85309c3.0136,1.63108 6.4052,2.4958 9.85634,2.49839l0.01037,0c11.36574,0 20.61884,-9.2091 20.62403,-20.53082c0,-5.48093 -2.14111,-10.64081 -6.03239,-14.51915" fill="white"></path></svg></button><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="32" fill="#FF5700"></circle><path d="M 53.34375 32 C 53.277344 30.160156 52.136719 28.53125 50.429688 27.839844 C 48.722656 27.148438 46.769531 27.523438 45.441406 28.800781 C 41.800781 26.324219 37.519531 24.957031 33.121094 24.863281 L 35.199219 14.878906 L 42.046875 16.320312 C 42.214844 17.882812 43.496094 19.09375 45.066406 19.171875 C 46.636719 19.253906 48.03125 18.183594 48.359375 16.644531 C 48.6875 15.105469 47.847656 13.558594 46.382812 12.992188 C 44.914062 12.425781 43.253906 13.007812 42.464844 14.367188 L 34.625 12.800781 C 34.363281 12.742188 34.09375 12.792969 33.871094 12.9375 C 33.648438 13.082031 33.492188 13.308594 33.441406 13.566406 L 31.070312 24.671875 C 26.617188 24.738281 22.277344 26.105469 18.59375 28.609375 C 17.242188 27.339844 15.273438 26.988281 13.570312 27.707031 C 11.863281 28.429688 10.746094 30.089844 10.71875 31.941406 C 10.691406 33.789062 11.757812 35.484375 13.441406 36.257812 C 13.402344 36.726562 13.402344 37.195312 13.441406 37.664062 C 13.441406 44.832031 21.792969 50.65625 32.097656 50.65625 C 42.398438 50.65625 50.753906 44.832031 50.753906 37.664062 C 50.789062 37.195312 50.789062 36.726562 50.753906 36.257812 C 52.363281 35.453125 53.371094 33.800781 53.34375 32 Z M 21.34375 35.199219 C 21.34375 33.433594 22.777344 32 24.542969 32 C 26.3125 32 27.742188 33.433594 27.742188 35.199219 C 27.742188 36.96875 26.3125 38.398438 24.542969 38.398438 C 22.777344 38.398438 21.34375 36.96875 21.34375 35.199219 Z M 39.9375 44 C 37.664062 45.710938 34.871094 46.582031 32.03125 46.464844 C 29.191406 46.582031 26.398438 45.710938 24.128906 44 C 23.847656 43.65625 23.871094 43.15625 24.183594 42.839844 C 24.5 42.527344 25 42.503906 25.34375 42.785156 C 27.269531 44.195312 29.617188 44.90625 32 44.800781 C 34.386719 44.929688 36.746094 44.242188 38.6875 42.847656 C 39.042969 42.503906 39.605469 42.511719 39.953125 42.863281 C 40.296875 43.21875 40.289062 43.785156 39.9375 44.128906 Z M 39.359375 38.527344 C 37.59375 38.527344 36.160156 37.09375 36.160156 35.328125 C 36.160156 33.5625 37.59375 32.128906 39.359375 32.128906 C 41.128906 32.128906 42.558594 33.5625 42.558594 35.328125 C 42.59375 36.203125 42.269531 37.054688 41.65625 37.6875 C 41.046875 38.316406 40.203125 38.664062 39.328125 38.65625 Z M 39.359375 38.527344" fill="white"></path></svg></button><button class="react-share__ShareButton text-slate-400" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="24" height="24"><circle cx="32" cy="32" r="32" fill="#25A3E3"></circle><path d="m45.90873,15.44335c-0.6901,-0.0281 -1.37668,0.14048 -1.96142,0.41265c-0.84989,0.32661 -8.63939,3.33986 -16.5237,6.39174c-3.9685,1.53296 -7.93349,3.06593 -10.98537,4.24067c-3.05012,1.1765 -5.34694,2.05098 -5.4681,2.09312c-0.80775,0.28096 -1.89996,0.63566 -2.82712,1.72788c-0.23354,0.27218 -0.46884,0.62161 -0.58825,1.10275c-0.11941,0.48114 -0.06673,1.09222 0.16682,1.5716c0.46533,0.96052 1.25376,1.35737 2.18443,1.71383c3.09051,0.99037 6.28638,1.93508 8.93263,2.8236c0.97632,3.44171 1.91401,6.89571 2.84116,10.34268c0.30554,0.69185 0.97105,0.94823 1.65764,0.95525l-0.00351,0.03512c0,0 0.53908,0.05268 1.06412,-0.07375c0.52679,-0.12292 1.18879,-0.42846 1.79109,-0.99212c0.662,-0.62161 2.45836,-2.38812 3.47683,-3.38552l7.6736,5.66477l0.06146,0.03512c0,0 0.84989,0.59703 2.09312,0.68132c0.62161,0.04214 1.4399,-0.07726 2.14229,-0.59176c0.70766,-0.51626 1.1765,-1.34683 1.396,-2.29506c0.65673,-2.86224 5.00979,-23.57745 5.75257,-27.00686l-0.02107,0.08077c0.51977,-1.93157 0.32837,-3.70159 -0.87096,-4.74991c-0.60054,-0.52152 -1.2924,-0.7498 -1.98425,-0.77965l0,0.00176zm-0.2072,3.29069c0.04741,0.0439 0.0439,0.0439 0.00351,0.04741c-0.01229,-0.00351 0.14048,0.2072 -0.15804,1.32576l-0.01229,0.04214l-0.00878,0.03863c-0.75858,3.50668 -5.15554,24.40802 -5.74203,26.96472c-0.08077,0.34417 -0.11414,0.31959 -0.09482,0.29852c-0.1756,-0.02634 -0.50045,-0.16506 -0.52679,-0.1756l-13.13468,-9.70175c4.4988,-4.33199 9.09945,-8.25307 13.744,-12.43229c0.8218,-0.41265 0.68483,-1.68573 -0.29852,-1.70681c-1.04305,0.24584 -1.92279,0.99564 -2.8798,1.47502c-5.49971,3.2626 -11.11882,6.13186 -16.55882,9.49279c-2.792,-0.97105 -5.57873,-1.77704 -8.15298,-2.57601c2.2336,-0.89555 4.00889,-1.55579 5.75608,-2.23009c3.05188,-1.1765 7.01687,-2.7042 10.98537,-4.24067c7.94051,-3.06944 15.92667,-6.16346 16.62028,-6.43037l0.05619,-0.02283l0.05268,-0.02283c0.19316,-0.0878 0.30378,-0.09658 0.35471,-0.10009c0,0 -0.01756,-0.05795 -0.00351,-0.04566l-0.00176,0zm-20.91715,22.0638l2.16687,1.60145c-0.93418,0.91311 -1.81743,1.77353 -2.45485,2.38812l0.28798,-3.98957" fill="white"></path></svg></button></div><hr class="rounded text-slate-400"/><div class="text-justify"><p>Recently, a new company called Bufferfly Effect has raised 75 million USD from well-known investors such as Benchmark Capital. You might not have heard of this company, but you probably have heard its LLM agent product - Manus, which went viral on social media last month. I was given an invitation code to Manus by my investor friend during its debut in early March. As an agent novice user, I was quite impressed by how the product was constructed, including its automation capability and user experience. I asked Manus to help me plan a trip to Japan and Manus demonstrated its work progress step by step and it is able to deliver a complete trip plan after 20 minutes (the speed can still be improved). Just like DeepSeek, Manus showcased what it actually did in a sandbox, being it a terminal or browser. I believe this kind of visualization of chain of thought &amp; action is what makes this product favoured by many users.</p>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/manus.jpeg" alt="Manus"/>
<em>Manus planning a trip to Japan</em></p>
<p>As a researcher in machine learning system, I spend my time on how to make AI more efficient and have limited knowledge on how agent systems work. Luckily, the open-source project <a class="text-slate-200 break-all" href="https://github.com/mannaandpoem/OpenManus">OpenManus</a> has made efforts to reproduce Manus and this gives me a opportunity to take a look at the inner working of agent systems.</p>
<p>This blog post is a summary of my exploration on OpenManus while reading through the source code and I hope it gives you a brief introduction to agent systems if you are also a beginner like me.</p>
<h2 id="prerequisites" class="text-white">Prerequisites</h2>
<p>Before we dive into the details of OpenManus, there are some background knowledge that you should know.</p>
<h3 id="1-agent-system" class="text-white">1. Agent System</h3>
<p>An agent is an autonomous system designed to perceive its environment, make decisions, and take actions to achieve specific goals without continuous human intervention. With the advent of ChatGPT, it is a common goal for the AI community to build a smart personal assistant that can help with daily tasks for everyone. Agent systems are the key to achieve this goal. Simply speaking, an agent system can help to plan, reason, make decision, and take action on your behalf to achieve a specific goal for you.</p>
<h3 id="2-react-agent" class="text-white">2. ReAct Agent</h3>
<p>ReAct agent is a simple but useful idea in agent. It combines both reasoning and execution in an interleaved manner to improve the agent&#x27;s performance in tasks. ReAct agents iteratively think and reason about the current task, and then decide whether to use tools to complete the current task. If the tools are needed, it will take the action and update the internal state. The general workflow is shown below.</p>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/react.png" alt="Manus"/></p>
<h3 id="3-function-calling" class="text-white">3. Function Calling</h3>
<p>Function calling is LLM&#x27;s ability to decide which function/tool to use and what parameters to provide to the function call when given a context and a list of function descriptions. The user needs to define functions in a specific format such as:</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>get_weather_func </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;type&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;function&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;name&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;get_weather&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;description&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Get current temperature for a given location.&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;parameters&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>        </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;type&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;object&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;properties&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>            </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;location&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;type&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;string&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;description&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;City and country e.g. BogotÃ¡, Colombia&quot;</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;required&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span><span>            </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;location&quot;</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;additionalProperties&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">False</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">}</span></code></div></pre>
<p>Then put this description in the tools field in the chat API, then the model will return a response. The response contains the name(s) of the function(s) to use, and the corresponding parameters structured in json format. In this way, the developer can look up for the actual function code and execute that function with the given parameters.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>chat</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>completion</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>create</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>    model</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span>
</span><span>    prompt</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span>
</span><span>    tools</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>
</span>        get_weather_func
<span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<p>Then the repsonse will contain a field called <code class="text-slate-200">tool_calls</code> which contains the name(s) of the function(s) to use, and the corresponding parameters structured in json format.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-json" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>tools</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>name</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;xxxx&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> parameters</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(355, 65%, 65%)">&quot;location&quot;</span><span class="token" style="color:hsl(207, 82%, 66%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Singapore&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">}</span></code></div></pre>
<h3 id="4-browser-user" class="text-white">4. Browser-User</h3>
<p><a class="text-slate-200 break-all" href="https://github.com/browser-use/browser-use">Browser-use</a> is a python package which manipulates and interacts with a web browser in real time. It is built upon the testing framework playwright. In browser-use, it has its own agent system built in the package, however, OpenManus mainly uses it Browser function and has written its own browser interaction logic.</p>
<h2 id="code-walkthrough" class="text-white">Code Walkthrough</h2>
<p>In this section, I will briefly go through the high-level project structure and explain how each component works. Afterwards, I will discuss how each components work together to deliver a complete agent system.</p>
<h3 id="core-modules" class="text-white">Core Modules</h3>
<p>This subsection cover the major modules in the OpenManus project. Each module is a collection of classes responsible for different functionalities, which will be covered in detail below.</p>
<h4 id="agents" class="text-white">Agents</h4>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/agent.png" alt="Agents"/></p>
<p>The <a class="text-slate-200 break-all" href="https://github.com/mannaandpoem/OpenManus/tree/main/app/agent">agent</a> module is the entrypoint of the agent system. It is responsible for the overall workflow of the agent system. As shown in the diagram above, the agents are organized in a hierarchical structure and the <code class="text-slate-200">ReActAgent</code> and <code class="text-slate-200">ToolCallAgent</code> define the core logic flow for task automation. Each class&#x27; duty is explained below:</p>
<ol>
<li class="text-slate-400">
<p>BaseAgent</p>
<p>This is the most fundamental class of an agent, it mainly takes care of the properties and states of the agent. For example, it has a name and description and also a system prompt to interact with the LLMs. The run method is the entrypoint of this agent, in run, the agent basically runs the step method repeatedly until its agent becomes FINISHED or IDLE.</p>
<ul>
<li class="text-slate-400">Finished: means the agent has finished the task</li>
<li class="text-slate-400">IDLE: means the agent has not finished the task but has reached the max number of steps, so it is forced to terminate</li>
</ul>
<p>The <code class="text-slate-200">step</code> method is an abstract method which the inherited classes will implement to define how each iteration goes.</p>
</li>
<li class="text-slate-400">
<p>ReActAgent</p>
<p>This class inherits BaseAgent and implements the step method. It uses the ReAct agent idea to combine both reasoning and action. Its step logic is like:</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">step</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">&quot;&quot;&quot;Execute a single step: think and act.&quot;&quot;&quot;</span><span>
</span><span>    should_act </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>think</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> should_act</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Thinking complete - no action needed&quot;</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>act</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<p>Both the think and act methods are abstract.</p>
</li>
<li class="text-slate-400">
<p>ToolCallAgent</p>
<p>ToolCallAgent includes the use of tools in the thinking and acting stages of a ReAct agent. In the thinking stage, it passes the available tools to LLM and let LLM to choose the suitable tools to use and the corresponding parameters via <strong>functional calling</strong>.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">think</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">bool</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span></span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>
</span>
<span>    response </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>llm</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>ask_tool</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>        messages</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>messages</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        system_msgs</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>Message</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>system_message</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>system_prompt</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>system_prompt
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">else</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        tools</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>available_tools</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>to_params</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        tool_choice</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_choices</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span></code></div></pre>
<p>In the acting stage, the agent will call the tool in order with the parameters given in the LLM response. The tool outputs are concatenated as the final output.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">act</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span></span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">&quot;&quot;&quot;Execute tool calls and handle their results&quot;&quot;&quot;</span><span>
</span><span></span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_calls</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span></span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_choices </span><span class="token" style="color:hsl(207, 82%, 66%)">==</span><span> ToolChoice</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>REQUIRED</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span></span><span class="token" style="color:hsl(286, 60%, 67%)">raise</span><span> ValueError</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>TOOL_CALL_REQUIRED</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>        </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Return last message content if no tool calls</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>messages</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(29, 54%, 61%)">1</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>content </span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;No content or commands to execute&quot;</span><span>
</span>
<span>    results </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">for</span><span> command </span><span class="token" style="color:hsl(286, 60%, 67%)">in</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_calls</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Reset base64_image for each tool call</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_current_base64_image </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span><span>
</span>
<span>        result </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>execute_tool</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>command</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>max_observe</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>            result </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> result</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>max_observe</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span>
<span>        logger</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>info</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            </span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;ðŸŽ¯ Tool &#x27;</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">command</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">function</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&#x27; completed its mission! Result: </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">result</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>        </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Add tool response to memory</span><span>
</span><span>        tool_msg </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> Message</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_message</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            content</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>result</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            tool_call_id</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>command</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(95, 38%, 62%)">id</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            name</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>command</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>function</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>name</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            base64_image</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_current_base64_image</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>memory</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>add_message</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>tool_msg</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        results</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>append</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>result</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;\n\n&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>join</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>results</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
</li>
<li class="text-slate-400">
<p>Manus</p>
<p>Manus is the main agent in the Open-Manus system. It is different from the ToolCallAgent in that it processes the prompt a bit before thinking. As shown in the code below, Manus will check if browser was used in the last 3 messages. If yes, it will format the prompt by injecting the current browser&#x27;s state information into the prompt. This allows the LLM to do a better job in function calling as it is aware of the content on the browser.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">think</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">bool</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">&quot;&quot;&quot;Process current state and decide next actions with appropriate context.&quot;&quot;&quot;</span><span>
</span><span>    original_prompt </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>next_step_prompt
</span><span>    recent_messages </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>memory</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>messages</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(29, 54%, 61%)">3</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>memory</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>messages </span><span class="token" style="color:hsl(286, 60%, 67%)">else</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>    browser_in_use </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">any</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>    tc</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>function</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>name </span><span class="token" style="color:hsl(207, 82%, 66%)">==</span><span> BrowserUseTool</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>name
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">for</span><span> msg </span><span class="token" style="color:hsl(286, 60%, 67%)">in</span><span> recent_messages
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> msg</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_calls
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">for</span><span> tc </span><span class="token" style="color:hsl(286, 60%, 67%)">in</span><span> msg</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tool_calls
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> browser_in_use</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>next_step_prompt </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>browser_context_helper</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>format_next_step_prompt</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    result </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">super</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>think</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Restore original prompt</span><span>
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>next_step_prompt </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> original_prompt
</span>
<span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> result</span></code></div></pre>
</li>
<li class="text-slate-400">
<p>BrowserAgent</p>
<p>This agent is implemented, but I don&#x27;t see it being used anywhere. Moreover, its functionality significantly overlaps with the BrowserUseTool in 2. Tool, so I will skip it for now.</p>
</li>
<li class="text-slate-400">
<p>MCPAgent &amp; SWEAgent</p>
<p>MCPAgent uses MCP servers as tools, and SWEAgent is just a different system prompt, so we skip them here.</p>
</li>
</ol>
<h4 id="tools" class="text-white">Tools</h4>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/tools.png" alt="Tools"/></p>
<p>The <code class="text-slate-200">tools</code> module implements a collection to external tools which can be used by the agent to retrive information and reason.</p>
<ol>
<li class="text-slate-400">
<p>Bash</p>
<p>This tool creates a bash session using asyncio.create_subprocess_shell, and receives bash command for execution. It then return the log in shell as output.</p>
</li>
<li class="text-slate-400">
<p>BrowserUseTool</p>
<p>It relies on the browser-use package to control the browser and execute commands such as go_to_url, click_element, input_text, scroll_up and so on. If the comand is extract_content, it will use markdownify to convert to the page content into Markdown text and use LLM to extract the text according to a goal given by the inputs.</p>
</li>
<li class="text-slate-400">
<p>CreateChatCompletiton</p>
<p>This tool does not actually perform chat completion, instead, it only extracts the necessary fields from a response data. When calling execute, the tool receives a list of strings (field names) and the response data and only keep the part of the data in the response according to the required fields.</p>
</li>
<li class="text-slate-400">
<p>DeepResearch</p>
<p>The Deep Research tool execution can be broken down into several steps:</p>
<ul>
<li class="text-slate-400">Optimize the search query using LLM</li>
<li class="text-slate-400">Perform a complete research cycle:</li>
<li class="text-slate-400">Search on the web</li>
<li class="text-slate-400">Extract insights using LLM</li>
<li class="text-slate-400">Generate follow-up queries and research with follow-up queries</li>
<li class="text-slate-400">Return research summary stored in context</li>
</ul>
</li>
<li class="text-slate-400">
<p>MCPClientTool</p>
<p>Init a MCP connection and send request to the MCP server.</p>
</li>
<li class="text-slate-400">
<p>PlanningTool</p>
<p>This tool does not perform planning on its own, it is more like a planning manager, which takes care of the CRUD operations of planning.</p>
</li>
<li class="text-slate-400">
<p>PythonExecute</p>
<p>It takes a code string and executes this piece of code in a new process and returns its output as result.</p>
</li>
<li class="text-slate-400">
<p>StrReplaceEditor</p>
<p>This tool is used for viewing, creating and editing files locally or in sandbox. This class basically abstracts the file operations and expose these operations as commands to the client calling this tool.</p>
</li>
<li class="text-slate-400">
<p>Terminate</p>
<p>This is a dummy tool, which only returns an ending message to convey the status of the task.</p>
</li>
<li class="text-slate-400">
<p>WebSearch</p>
<p>It basically conducts search on all available search engines including google, baidu, duckduckgo, and bing. Google is set as the preferred engine so it will be used first. These search engine results will only include meta information like position, title and URL. The tool will then fetch the content of the web pages and return as response.</p>
</li>
</ol>
<h4 id="sandbox" class="text-white">Sandbox</h4>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/sandbox.png" alt="  "/></p>
<ol>
<li class="text-slate-400">
<p>BaseSandboxClient</p>
<p>This is an interface for sandbox, which defines the methods for child classes to implement, these methods include file operations and run_command.</p>
</li>
<li class="text-slate-400">
<p>LocalSandbox</p>
<p>This is a child class for BaseSandboxClient and also a wrapper for DockerSandbox. It call the methods in DockerSandbox to implement the abstract methods.</p>
</li>
<li class="text-slate-400">
<p>DockerSandbox</p>
<p>This class is wrapper for the Docker Python SDK as it contains a DockerClient object, it use this client to implement methods such as file operations. run_command is achieved by using the AsyncDockerizedTerminal.</p>
</li>
<li class="text-slate-400">
<p>AsyncDockerizedTerminal</p>
<p>This object basically creates a Docker container session and send the command to the session and retrieve the command output.</p>
</li>
<li class="text-slate-400">
<p>DockerSession</p>
<p>This object uses the Docker APIClient to interact with an existing container. It can exec into the container by exec_create to get an interactive session. Then, it uses exec_start to create a socket connection with the session, sending the command and retrieving console output via socket.</p>
</li>
</ol>
<h4 id="memory" class="text-white">Memory</h4>
<p><img src="https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/memory.png" alt="Memory"/></p>
<ol>
<li class="text-slate-400">
<p>Message</p>
<p>Message represents the chat message in a conversation. It can be from the system, user, assistant or tool.</p>
</li>
<li class="text-slate-400">
<p>Memory</p>
<p>Memory is basically a list of messages in history. It is limited by the max_messagse size and uses a FIFO eviction policy.</p>
</li>
</ol>
<h3 id="collective-logic" class="text-white">Collective Logic</h3>
<h4 id="what-is-openmanus-workflow" class="text-white">What is OpenManus&#x27; workflow?</h4>
<p>Manus carries out work in 4 steps:</p>
<ol>
<li class="text-slate-400">
<p>Initialization stage</p>
<p>Manus inherits the ToolCallAgent class, during initialization, it will set some basic properties such as name, system prompt, next step prompt and list the available tools it can use. In Manus, the available tools inlcude PythonExecute, BrowserUseTool, StrReplaceEditor and Terminate.
class Manus(ToolCallAgent):</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">class</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">Manus</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>ToolCallAgent</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span></span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">&quot;&quot;&quot;A versatile general-purpose agent.&quot;&quot;&quot;</span><span>
</span>
<span>    name</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Manus&quot;</span><span>
</span><span>    description</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>        </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;A versatile agent that can solve various tasks using multiple tools&quot;</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    system_prompt</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> SYSTEM_PROMPT</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span class="token" style="color:hsl(95, 38%, 62%)">format</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>directory</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>config</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>workspace_root</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    next_step_prompt</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> NEXT_STEP_PROMPT
</span>
<span>    max_observe</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">int</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">10000</span><span>
</span><span>    max_steps</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">int</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">20</span><span>
</span>
<span>    </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Add general-purpose tools to the tool collection</span><span>
</span><span>    available_tools</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> ToolCollection </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> Field</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>        default_factory</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(286, 60%, 67%)">lambda</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> ToolCollection</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            PythonExecute</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> BrowserUseTool</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> StrReplaceEditor</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> Terminate</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    special_tool_names</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">list</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> Field</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>default_factory</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(286, 60%, 67%)">lambda</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>Terminate</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>name</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>    browser_context_helper</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> Optional</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>BrowserContextHelper</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span></code></div></pre>
</li>
<li class="text-slate-400">
<p>Thinking Stage</p>
<p>This is the first stage of a ReAct agent, Manus will think about its next move based on the current and recent messages. In Manus, it handles the browser-use specifically: - If there is any recent use of browser, it will format the next step prompt using the browser_context_helper. format_next_step_prompt will inject the current states of the browser into the prompt, the states include URL, tabs, clickable elements and so on.</p>
<p>It then calls its parent class ToolCallAgent&#x27;s thinking method. In this method, Manus calls LLM to think about the next action. at the same, the available tools are given to LLMs for function calling as well, so LLM will select the suitable tools to use for the next action.</p>
</li>
</ol>
<ul>
<li class="text-slate-400">
<p>Acting Stage</p>
<p>In this stage, Manus calls the tools if there is any.</p>
</li>
<li class="text-slate-400">
<p>Looping Stage</p>
<p>The thinking and acting stages are wrapped in the run method of Manus. This method runs a for loop to repeat thinking and acting stages until the state becomes finished or the maximum step has been reached.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">run</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> request</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> Optional</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>state </span><span class="token" style="color:hsl(207, 82%, 66%)">!=</span><span> AgentState</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>IDLE</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      </span><span class="token" style="color:hsl(286, 60%, 67%)">raise</span><span> RuntimeError</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Cannot run agent from state: </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">state</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> request</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>update_memory</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;user&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> request</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>  results</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> List</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(95, 38%, 62%)">str</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">with</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>state_context</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>AgentState</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>RUNNING</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      </span><span class="token" style="color:hsl(286, 60%, 67%)">while</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>          self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>current_step </span><span class="token" style="color:hsl(207, 82%, 66%)">&lt;</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>max_steps </span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>state </span><span class="token" style="color:hsl(207, 82%, 66%)">!=</span><span> AgentState</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>FINISHED
</span><span>      </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>          self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>current_step </span><span class="token" style="color:hsl(207, 82%, 66%)">+=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">1</span><span>
</span><span>          logger</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>info</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Executing step </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">current_step</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">/</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">max_steps</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>          step_result </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>step</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>          </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>is_stuck</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>              self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>handle_stuck_state</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>          results</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>append</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Step </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">current_step</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">: </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">step_result</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>      </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>current_step </span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;=</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>max_steps</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>          self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>current_step </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span>
</span><span>          self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>state </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> AgentState</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>IDLE
</span><span>          results</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>append</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Terminated: Reached max steps (</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">.</span><span class="token string-interpolation interpolation">max_steps</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">)&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> SANDBOX_CLIENT</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>cleanup</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;\n&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>join</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>results</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> results </span><span class="token" style="color:hsl(286, 60%, 67%)">else</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;No steps executed&quot;</span></code></div></pre>
</li>
<li class="text-slate-400">
<p>Cleanup Stage</p>
<p>In this stage, Manus will clear up the resources used during the task such as the browser.</p>
</li>
</ul>
<h4 id="how-does-openmanus-interact-with-the-tools" class="text-white">How does OpenManus interact with the tools?</h4>
<p>To understand this, we can separate it into two questions:</p>
<ul>
<li class="text-slate-400">How does manus know which tool to use?</li>
<li class="text-slate-400">How does manus invoke the tool?</li>
</ul>
<p>These two questions indeed correspond to the thinking and acting stages as mentioned above. During the thinking stage, Manus will use the function calling feature of the LLM API to let the model decide the usable tools and parameters. During the acting stage, Manus will iterate over the tool list and feed each tool function with its parameters and fetch the result.</p>
<h4 id="how-does-openmanus-interact-with-the-browser" class="text-white">How does OpenManus interact with the browser?</h4>
<p>Manus does not use VLM to decide which elements to click or where is the URL bar. Instead, browser-use will return these information as browser states and the states are organized as a dictionary. For example, each clickable element in the DOM tree is converted to a string, and these states are given to LLM as context for the LLM to select which element to click.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">async</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">get_current_state</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> context</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> Optional</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>BrowserContext</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span><span>
</span><span>    </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">-</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        </span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">&quot;&quot;&quot;
</span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">        Get the current browser state as a ToolResult.
</span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">        If context is not provided, uses self.context.
</span><span class="token triple-quoted-string" style="color:hsl(95, 38%, 62%)">        &quot;&quot;&quot;</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">try</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Use provided context or fall back to self.context</span><span>
</span><span>            ctx </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> context </span><span class="token" style="color:hsl(286, 60%, 67%)">or</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>context
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>                </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>error</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Browser context not initialized&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            state </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>get_state</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Create a viewport_info dictionary if it doesn&#x27;t exist</span><span>
</span><span>            viewport_height </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span>
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">hasattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;viewport_info&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>viewport_info</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>                viewport_height </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>viewport_info</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>height
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">elif</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">hasattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;config&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">hasattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>config</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;browser_window_size&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>                viewport_height </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>config</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>browser_window_size</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>get</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;height&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Take a screenshot for the state</span><span>
</span><span>            page </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> ctx</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>get_current_page</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> page</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>bring_to_front</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> page</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>wait_for_load_state</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            screenshot </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> page</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>screenshot</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>                full_page</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(29, 54%, 61%)">True</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> animations</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;disabled&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">type</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;jpeg&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> quality</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(29, 54%, 61%)">100</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            screenshot </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> base64</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>b64encode</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>screenshot</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>decode</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;utf-8&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span>
<span>            </span><span class="token" style="color:hsl(220, 10%, 40%);font-style:italic"># Build the state info with all required fields</span><span>
</span><span>            state_info </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;url&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>url</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;title&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>title</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;tabs&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>tab</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>model_dump</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">for</span><span> tab </span><span class="token" style="color:hsl(286, 60%, 67%)">in</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>tabs</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;help&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;[0], [1], [2], etc., represent clickable indices corresponding to the elements listed. Clicking on these indices will navigate to or interact with the respective content behind them.&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;interactive_elements&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>                    state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>element_tree</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>clickable_elements_to_string</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>                    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> state</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>element_tree
</span><span>                    </span><span class="token" style="color:hsl(286, 60%, 67%)">else</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;&quot;</span><span>
</span><span>                </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;scroll_info&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">{</span><span>
</span><span>                    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_above&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">getattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_above&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_below&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">getattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_below&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                    </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;total_height&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">getattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_above&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>                    </span><span class="token" style="color:hsl(207, 82%, 66%)">+</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">getattr</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;pixels_below&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>                    </span><span class="token" style="color:hsl(207, 82%, 66%)">+</span><span> viewport_height</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;viewport_height&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span> viewport_height</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 14%, 71%)">}</span><span>
</span>
<span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>                output</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>json</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>dumps</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>state_info</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> indent</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(29, 54%, 61%)">4</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> ensure_ascii</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(29, 54%, 61%)">False</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                base64_image</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>screenshot</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>            </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">except</span><span> Exception </span><span class="token" style="color:hsl(286, 60%, 67%)">as</span><span> e</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>            </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>error</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Failed to get browser state: </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation" style="color:hsl(95, 38%, 62%)">str</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">(</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">)</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<p>The LLM will then return the index of the element to click after function calling query, Manus will then get the element by index and perform click action.</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">elif</span><span> action </span><span class="token" style="color:hsl(207, 82%, 66%)">==</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;click_element&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> index </span><span class="token" style="color:hsl(286, 60%, 67%)">is</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">None</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>            error</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token" style="color:hsl(95, 38%, 62%)">&quot;Index is required for &#x27;click_element&#x27; action&quot;</span><span>
</span><span>        </span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    element </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> context</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>get_dom_element_by_index</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>index</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">not</span><span> element</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>error</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Element with index </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">index</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)"> not found&quot;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    download_path </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">await</span><span> context</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_click_element_node</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>element</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    output </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot;Clicked element at index </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">index</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> download_path</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        output </span><span class="token" style="color:hsl(207, 82%, 66%)">+=</span><span> </span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">f&quot; - Downloaded file to </span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">{</span><span class="token string-interpolation interpolation">download_path</span><span class="token string-interpolation interpolation" style="color:hsl(220, 14%, 71%)">}</span><span class="token string-interpolation" style="color:hsl(95, 38%, 62%)">&quot;</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span> ToolResult</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>output</span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span>output</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<h4 id="how-does-manus-manage-its-memory" class="text-white">How does Manus manage its memory?</h4>
<p>Manus adds the following content to memory in order:</p>
<ul>
<li class="text-slate-400">Before the thinking stage, Manusadds the user request content into memory at the beginning of the run method</li>
<li class="text-slate-400">During the think stage, Manusadds the LLM response to memory. If there is any exception, the exception is added to memory as well.</li>
<li class="text-slate-400">During the acting stage, Manus adds the tool response message to memory.</li>
</ul>
<h2 id="conclusion" class="text-white">Conclusion</h2>
<p>By walking through the fundamental ideas and some high-level code review, I hope that you should have a rough idea of how OpenManus works now. However, I can&#x27;t say that everything in this blog post is correct as I am still a novice in agent, do let me know if there is any error to rectify.</p>
<h2 id="references" class="text-white">References</h2>
<ul>
<li class="text-slate-400"><a class="text-slate-200 break-all" href="https://manus.im/app">Manus</a></li>
<li class="text-slate-400"><a class="text-slate-200 break-all" href="https://github.com/mannaandpoem/OpenManus">OpenManus</a></li>
<li class="text-slate-400"><a class="text-slate-200 break-all" href="https://python.langchain.com/v0.1/docs/modules/agents/agent_types/react/">ReAct-Langchain</a></li>
<li class="text-slate-400"><a class="text-slate-200 break-all" href="https://arxiv.org/pdf/2210.03629">ReAct: Synergizing Reasoning and Acting in Language Models</a></li>
</ul></div></article></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"2025-04-27-open-manus","readingTime":"16 min read","source":"\nRecently, a new company called Bufferfly Effect has raised 75 million USD from well-known investors such as Benchmark Capital. You might not have heard of this company, but you probably have heard its LLM agent product - Manus, which went viral on social media last month. I was given an invitation code to Manus by my investor friend during its debut in early March. As an agent novice user, I was quite impressed by how the product was constructed, including its automation capability and user experience. I asked Manus to help me plan a trip to Japan and Manus demonstrated its work progress step by step and it is able to deliver a complete trip plan after 20 minutes (the speed can still be improved). Just like DeepSeek, Manus showcased what it actually did in a sandbox, being it a terminal or browser. I believe this kind of visualization of chain of thought \u0026 action is what makes this product favoured by many users.\n\n![Manus](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/manus.jpeg)\n_Manus planning a trip to Japan_\n\nAs a researcher in machine learning system, I spend my time on how to make AI more efficient and have limited knowledge on how agent systems work. Luckily, the open-source project [OpenManus](https://github.com/mannaandpoem/OpenManus) has made efforts to reproduce Manus and this gives me a opportunity to take a look at the inner working of agent systems.\n\nThis blog post is a summary of my exploration on OpenManus while reading through the source code and I hope it gives you a brief introduction to agent systems if you are also a beginner like me.\n\n## Prerequisites\n\nBefore we dive into the details of OpenManus, there are some background knowledge that you should know.\n\n### 1. Agent System\n\nAn agent is an autonomous system designed to perceive its environment, make decisions, and take actions to achieve specific goals without continuous human intervention. With the advent of ChatGPT, it is a common goal for the AI community to build a smart personal assistant that can help with daily tasks for everyone. Agent systems are the key to achieve this goal. Simply speaking, an agent system can help to plan, reason, make decision, and take action on your behalf to achieve a specific goal for you.\n\n### 2. ReAct Agent\n\nReAct agent is a simple but useful idea in agent. It combines both reasoning and execution in an interleaved manner to improve the agent's performance in tasks. ReAct agents iteratively think and reason about the current task, and then decide whether to use tools to complete the current task. If the tools are needed, it will take the action and update the internal state. The general workflow is shown below.\n\n![Manus](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/react.png)\n\n### 3. Function Calling\n\nFunction calling is LLM's ability to decide which function/tool to use and what parameters to provide to the function call when given a context and a list of function descriptions. The user needs to define functions in a specific format such as:\n\n```python\nget_weather_func = {\n    \"type\": \"function\",\n    \"name\": \"get_weather\",\n    \"description\": \"Get current temperature for a given location.\",\n    \"parameters\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"location\": {\n                \"type\": \"string\",\n                \"description\": \"City and country e.g. BogotÃ¡, Colombia\"\n            }\n        },\n        \"required\": [\n            \"location\"\n        ],\n        \"additionalProperties\": False\n    }\n}\n```\n\nThen put this description in the tools field in the chat API, then the model will return a response. The response contains the name(s) of the function(s) to use, and the corresponding parameters structured in json format. In this way, the developer can look up for the actual function code and execute that function with the given parameters.\n\n```python\nchat.completion.create(\n    model=\"\"\n    prompt=\"\"\n    tools=[\n        get_weather_func\n        ]\n)\n```\n\nThen the repsonse will contain a field called `tool_calls` which contains the name(s) of the function(s) to use, and the corresponding parameters structured in json format.\n\n```json\ntools: {name: \"xxxx\", parameters: \"location\": \"Singapore\"}\n```\n\n### 4. Browser-User\n\n[Browser-use](https://github.com/browser-use/browser-use) is a python package which manipulates and interacts with a web browser in real time. It is built upon the testing framework playwright. In browser-use, it has its own agent system built in the package, however, OpenManus mainly uses it Browser function and has written its own browser interaction logic.\n\n## Code Walkthrough\n\nIn this section, I will briefly go through the high-level project structure and explain how each component works. Afterwards, I will discuss how each components work together to deliver a complete agent system.\n\n### Core Modules\n\nThis subsection cover the major modules in the OpenManus project. Each module is a collection of classes responsible for different functionalities, which will be covered in detail below.\n\n#### Agents\n\n![Agents](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/agent.png)\n\nThe [agent](https://github.com/mannaandpoem/OpenManus/tree/main/app/agent) module is the entrypoint of the agent system. It is responsible for the overall workflow of the agent system. As shown in the diagram above, the agents are organized in a hierarchical structure and the `ReActAgent` and `ToolCallAgent` define the core logic flow for task automation. Each class' duty is explained below:\n\n1. BaseAgent\n\n   This is the most fundamental class of an agent, it mainly takes care of the properties and states of the agent. For example, it has a name and description and also a system prompt to interact with the LLMs. The run method is the entrypoint of this agent, in run, the agent basically runs the step method repeatedly until its agent becomes FINISHED or IDLE.\n\n   - Finished: means the agent has finished the task\n   - IDLE: means the agent has not finished the task but has reached the max number of steps, so it is forced to terminate\n\n   The `step` method is an abstract method which the inherited classes will implement to define how each iteration goes.\n\n2. ReActAgent\n\n   This class inherits BaseAgent and implements the step method. It uses the ReAct agent idea to combine both reasoning and action. Its step logic is like:\n\n   ```python\n   async def step(self) -\u003e str:\n       \"\"\"Execute a single step: think and act.\"\"\"\n       should_act = await self.think()\n       if not should_act:\n           return \"Thinking complete - no action needed\"\n       return await self.act()\n   ```\n\n   Both the think and act methods are abstract.\n\n3. ToolCallAgent\n\n   ToolCallAgent includes the use of tools in the thinking and acting stages of a ReAct agent. In the thinking stage, it passes the available tools to LLM and let LLM to choose the suitable tools to use and the corresponding parameters via **functional calling**.\n\n   ```python\n   async def think(self) -\u003e bool:\n   ...\n\n       response = await self.llm.ask_tool(\n           messages=self.messages,\n           system_msgs=(\n               [Message.system_message(self.system_prompt)]\n               if self.system_prompt\n               else None\n           ),\n           tools=self.available_tools.to_params(),\n           tool_choice=self.tool_choices,\n       )\n       ...\n   ```\n\n   In the acting stage, the agent will call the tool in order with the parameters given in the LLM response. The tool outputs are concatenated as the final output.\n\n   ```python\n   async def act(self) -\u003e str:\n   \"\"\"Execute tool calls and handle their results\"\"\"\n   if not self.tool_calls:\n   if self.tool_choices == ToolChoice.REQUIRED:\n   raise ValueError(TOOL_CALL_REQUIRED)\n\n           # Return last message content if no tool calls\n           return self.messages[-1].content or \"No content or commands to execute\"\n\n       results = []\n       for command in self.tool_calls:\n           # Reset base64_image for each tool call\n           self._current_base64_image = None\n\n           result = await self.execute_tool(command)\n\n           if self.max_observe:\n               result = result[: self.max_observe]\n\n           logger.info(\n               f\"ðŸŽ¯ Tool '{command.function.name}' completed its mission! Result: {result}\"\n           )\n\n           # Add tool response to memory\n           tool_msg = Message.tool_message(\n               content=result,\n               tool_call_id=command.id,\n               name=command.function.name,\n               base64_image=self._current_base64_image,\n           )\n           self.memory.add_message(tool_msg)\n           results.append(result)\n\n       return \"\\n\\n\".join(results)\n   ```\n\n4. Manus\n\n   Manus is the main agent in the Open-Manus system. It is different from the ToolCallAgent in that it processes the prompt a bit before thinking. As shown in the code below, Manus will check if browser was used in the last 3 messages. If yes, it will format the prompt by injecting the current browser's state information into the prompt. This allows the LLM to do a better job in function calling as it is aware of the content on the browser.\n\n   ```python\n   async def think(self) -\u003e bool:\n       \"\"\"Process current state and decide next actions with appropriate context.\"\"\"\n       original_prompt = self.next_step_prompt\n       recent_messages = self.memory.messages[-3:] if self.memory.messages else []\n       browser_in_use = any(\n       tc.function.name == BrowserUseTool().name\n       for msg in recent_messages\n       if msg.tool_calls\n       for tc in msg.tool_calls\n       )\n\n       if browser_in_use:\n           self.next_step_prompt = (\n               await self.browser_context_helper.format_next_step_prompt()\n           )\n\n       result = await super().think()\n\n       # Restore original prompt\n       self.next_step_prompt = original_prompt\n\n       return result\n   ```\n\n5. BrowserAgent\n\n   This agent is implemented, but I don't see it being used anywhere. Moreover, its functionality significantly overlaps with the BrowserUseTool in 2. Tool, so I will skip it for now.\n\n6. MCPAgent \u0026 SWEAgent\n\n   MCPAgent uses MCP servers as tools, and SWEAgent is just a different system prompt, so we skip them here.\n\n#### Tools\n\n![Tools](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/tools.png)\n\nThe `tools` module implements a collection to external tools which can be used by the agent to retrive information and reason.\n\n1. Bash\n\n   This tool creates a bash session using asyncio.create_subprocess_shell, and receives bash command for execution. It then return the log in shell as output.\n\n2. BrowserUseTool\n\n   It relies on the browser-use package to control the browser and execute commands such as go_to_url, click_element, input_text, scroll_up and so on. If the comand is extract_content, it will use markdownify to convert to the page content into Markdown text and use LLM to extract the text according to a goal given by the inputs.\n\n3. CreateChatCompletiton\n\n   This tool does not actually perform chat completion, instead, it only extracts the necessary fields from a response data. When calling execute, the tool receives a list of strings (field names) and the response data and only keep the part of the data in the response according to the required fields.\n\n4. DeepResearch\n\n   The Deep Research tool execution can be broken down into several steps:\n\n   - Optimize the search query using LLM\n   - Perform a complete research cycle:\n   - Search on the web\n   - Extract insights using LLM\n   - Generate follow-up queries and research with follow-up queries\n   - Return research summary stored in context\n\n5. MCPClientTool\n\n   Init a MCP connection and send request to the MCP server.\n\n6. PlanningTool\n\n   This tool does not perform planning on its own, it is more like a planning manager, which takes care of the CRUD operations of planning.\n\n7. PythonExecute\n\n   It takes a code string and executes this piece of code in a new process and returns its output as result.\n\n8. StrReplaceEditor\n\n   This tool is used for viewing, creating and editing files locally or in sandbox. This class basically abstracts the file operations and expose these operations as commands to the client calling this tool.\n\n9. Terminate\n\n   This is a dummy tool, which only returns an ending message to convey the status of the task.\n\n10. WebSearch\n\n    It basically conducts search on all available search engines including google, baidu, duckduckgo, and bing. Google is set as the preferred engine so it will be used first. These search engine results will only include meta information like position, title and URL. The tool will then fetch the content of the web pages and return as response.\n\n#### Sandbox\n\n![  ](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/sandbox.png)\n\n1. BaseSandboxClient\n\n   This is an interface for sandbox, which defines the methods for child classes to implement, these methods include file operations and run_command.\n\n2. LocalSandbox\n\n   This is a child class for BaseSandboxClient and also a wrapper for DockerSandbox. It call the methods in DockerSandbox to implement the abstract methods.\n\n3. DockerSandbox\n\n   This class is wrapper for the Docker Python SDK as it contains a DockerClient object, it use this client to implement methods such as file operations. run_command is achieved by using the AsyncDockerizedTerminal.\n\n4. AsyncDockerizedTerminal\n\n   This object basically creates a Docker container session and send the command to the session and retrieve the command output.\n\n5. DockerSession\n\n   This object uses the Docker APIClient to interact with an existing container. It can exec into the container by exec_create to get an interactive session. Then, it uses exec_start to create a socket connection with the session, sending the command and retrieving console output via socket.\n\n#### Memory\n\n![Memory](https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/memory.png)\n\n1. Message\n\n   Message represents the chat message in a conversation. It can be from the system, user, assistant or tool.\n\n2. Memory\n\n   Memory is basically a list of messages in history. It is limited by the max_messagse size and uses a FIFO eviction policy.\n\n### Collective Logic\n\n#### What is OpenManus' workflow?\n\nManus carries out work in 4 steps:\n\n1.  Initialization stage\n\n    Manus inherits the ToolCallAgent class, during initialization, it will set some basic properties such as name, system prompt, next step prompt and list the available tools it can use. In Manus, the available tools inlcude PythonExecute, BrowserUseTool, StrReplaceEditor and Terminate.\n    class Manus(ToolCallAgent):\n\n    ```python\n    class Manus(ToolCallAgent):\n    \"\"\"A versatile general-purpose agent.\"\"\"\n\n        name: str = \"Manus\"\n        description: str = (\n            \"A versatile agent that can solve various tasks using multiple tools\"\n        )\n\n        system_prompt: str = SYSTEM_PROMPT.format(directory=config.workspace_root)\n        next_step_prompt: str = NEXT_STEP_PROMPT\n\n        max_observe: int = 10000\n        max_steps: int = 20\n\n        # Add general-purpose tools to the tool collection\n        available_tools: ToolCollection = Field(\n            default_factory=lambda: ToolCollection(\n                PythonExecute(), BrowserUseTool(), StrReplaceEditor(), Terminate()\n            )\n        )\n\n        special_tool_names: list[str] = Field(default_factory=lambda: [Terminate().name])\n\n        browser_context_helper: Optional[BrowserContextHelper] = None\n    ```\n\n2.  Thinking Stage\n\n    This is the first stage of a ReAct agent, Manus will think about its next move based on the current and recent messages. In Manus, it handles the browser-use specifically: - If there is any recent use of browser, it will format the next step prompt using the browser_context_helper. format_next_step_prompt will inject the current states of the browser into the prompt, the states include URL, tabs, clickable elements and so on.\n\n    It then calls its parent class ToolCallAgent's thinking method. In this method, Manus calls LLM to think about the next action. at the same, the available tools are given to LLMs for function calling as well, so LLM will select the suitable tools to use for the next action.\n\n- Acting Stage\n\n  In this stage, Manus calls the tools if there is any.\n\n- Looping Stage\n\n  The thinking and acting stages are wrapped in the run method of Manus. This method runs a for loop to repeat thinking and acting stages until the state becomes finished or the maximum step has been reached.\n\n  ```python\n  async def run(self, request: Optional[str] = None) -\u003e str:\n    if self.state != AgentState.IDLE:\n        raise RuntimeError(f\"Cannot run agent from state: {self.state}\")\n    if request:\n        self.update_memory(\"user\", request)\n    results: List[str] = []\n    async with self.state_context(AgentState.RUNNING):\n        while (\n            self.current_step \u003c self.max_steps and self.state != AgentState.FINISHED\n        ):\n            self.current_step += 1\n            logger.info(f\"Executing step {self.current_step}/{self.max_steps}\")\n            step_result = await self.step()\n            if self.is_stuck():\n                self.handle_stuck_state()\n            results.append(f\"Step {self.current_step}: {step_result}\")\n        if self.current_step \u003e= self.max_steps:\n            self.current_step = 0\n            self.state = AgentState.IDLE\n            results.append(f\"Terminated: Reached max steps ({self.max_steps})\")\n    await SANDBOX_CLIENT.cleanup()\n    return \"\\n\".join(results) if results else \"No steps executed\"\n  ```\n\n- Cleanup Stage\n\n  In this stage, Manus will clear up the resources used during the task such as the browser.\n\n#### How does OpenManus interact with the tools?\n\nTo understand this, we can separate it into two questions:\n\n- How does manus know which tool to use?\n- How does manus invoke the tool?\n\nThese two questions indeed correspond to the thinking and acting stages as mentioned above. During the thinking stage, Manus will use the function calling feature of the LLM API to let the model decide the usable tools and parameters. During the acting stage, Manus will iterate over the tool list and feed each tool function with its parameters and fetch the result.\n\n#### How does OpenManus interact with the browser?\n\nManus does not use VLM to decide which elements to click or where is the URL bar. Instead, browser-use will return these information as browser states and the states are organized as a dictionary. For example, each clickable element in the DOM tree is converted to a string, and these states are given to LLM as context for the LLM to select which element to click.\n\n```python\nasync def get_current_state(\n        self, context: Optional[BrowserContext] = None\n    ) -\u003e ToolResult:\n        \"\"\"\n        Get the current browser state as a ToolResult.\n        If context is not provided, uses self.context.\n        \"\"\"\n        try:\n            # Use provided context or fall back to self.context\n            ctx = context or self.context\n            if not ctx:\n                return ToolResult(error=\"Browser context not initialized\")\n\n            state = await ctx.get_state()\n\n            # Create a viewport_info dictionary if it doesn't exist\n            viewport_height = 0\n            if hasattr(state, \"viewport_info\") and state.viewport_info:\n                viewport_height = state.viewport_info.height\n            elif hasattr(ctx, \"config\") and hasattr(ctx.config, \"browser_window_size\"):\n                viewport_height = ctx.config.browser_window_size.get(\"height\", 0)\n\n            # Take a screenshot for the state\n            page = await ctx.get_current_page()\n\n            await page.bring_to_front()\n            await page.wait_for_load_state()\n\n            screenshot = await page.screenshot(\n                full_page=True, animations=\"disabled\", type=\"jpeg\", quality=100\n            )\n\n            screenshot = base64.b64encode(screenshot).decode(\"utf-8\")\n\n            # Build the state info with all required fields\n            state_info = {\n                \"url\": state.url,\n                \"title\": state.title,\n                \"tabs\": [tab.model_dump() for tab in state.tabs],\n                \"help\": \"[0], [1], [2], etc., represent clickable indices corresponding to the elements listed. Clicking on these indices will navigate to or interact with the respective content behind them.\",\n                \"interactive_elements\": (\n                    state.element_tree.clickable_elements_to_string()\n                    if state.element_tree\n                    else \"\"\n                ),\n                \"scroll_info\": {\n                    \"pixels_above\": getattr(state, \"pixels_above\", 0),\n                    \"pixels_below\": getattr(state, \"pixels_below\", 0),\n                    \"total_height\": getattr(state, \"pixels_above\", 0)\n                    + getattr(state, \"pixels_below\", 0)\n                    + viewport_height,\n                },\n                \"viewport_height\": viewport_height,\n            }\n\n            return ToolResult(\n                output=json.dumps(state_info, indent=4, ensure_ascii=False),\n                base64_image=screenshot,\n            )\n        except Exception as e:\n            return ToolResult(error=f\"Failed to get browser state: {str(e)}\")\n```\n\nThe LLM will then return the index of the element to click after function calling query, Manus will then get the element by index and perform click action.\n\n```python\nelif action == \"click_element\":\n    if index is None:\n        return ToolResult(\n            error=\"Index is required for 'click_element' action\"\n        )\n    element = await context.get_dom_element_by_index(index)\n    if not element:\n        return ToolResult(error=f\"Element with index {index} not found\")\n    download_path = await context._click_element_node(element)\n    output = f\"Clicked element at index {index}\"\n    if download_path:\n        output += f\" - Downloaded file to {download_path}\"\n    return ToolResult(output=output)\n```\n\n#### How does Manus manage its memory?\n\nManus adds the following content to memory in order:\n\n- Before the thinking stage, Manusadds the user request content into memory at the beginning of the run method\n- During the think stage, Manusadds the LLM response to memory. If there is any exception, the exception is added to memory as well.\n- During the acting stage, Manus adds the tool response message to memory.\n\n## Conclusion\n\nBy walking through the fundamental ideas and some high-level code review, I hope that you should have a rough idea of how OpenManus works now. However, I can't say that everything in this blog post is correct as I am still a novice in agent, do let me know if there is any error to rectify.\n\n## References\n\n- [Manus](https://manus.im/app)\n- [OpenManus](https://github.com/mannaandpoem/OpenManus)\n- [ReAct-Langchain](https://python.langchain.com/v0.1/docs/modules/agents/agent_types/react/)\n- [ReAct: Synergizing Reasoning and Acting in Language Models](https://arxiv.org/pdf/2210.03629)\n","frontMatter":{"title":"Understanding OpenManus: How Agent Systems Work","description":"Discover how agent systems like OpenManus plan, coordinate, and adapt to complete complex tasks","date":"2025-04-27","ogImage":{"url":"https://franklee.xyz/public_assets/blog_media/2025-04-27-open-manus/cover.png"},"tags":["agent","open-source","LLM"]},"tags":["agent","open-source","LLM"]},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"2025-04-27-open-manus"},"buildId":"QZoNBVUQXCAFi14FF8sCC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>